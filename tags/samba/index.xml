<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Samba on 点半九</title><link>https://www.dianbanjiu.com/tags/samba/</link><description>Recent content in Samba on 点半九</description><generator>Hugo -- gohugo.io</generator><language>en</language><lastBuildDate>Thu, 14 Apr 2022 16:36:33 +0800</lastBuildDate><atom:link href="https://www.dianbanjiu.com/tags/samba/index.xml" rel="self" type="application/rss+xml"/><item><title>Linux 访问 Windows 共享目录</title><link>https://www.dianbanjiu.com/post/linux-%E8%AE%BF%E9%97%AE-windows-%E5%85%B1%E4%BA%AB%E7%9B%AE%E5%BD%95/</link><pubDate>Thu, 14 Apr 2022 16:36:33 +0800</pubDate><guid>https://www.dianbanjiu.com/post/linux-%E8%AE%BF%E9%97%AE-windows-%E5%85%B1%E4%BA%AB%E7%9B%AE%E5%BD%95/</guid><description>&lt;p>因为工作需要，需要在电脑上安装一个 VPN 程序，但是官方并没有提供 Linux 版本，通过 wine 虽然能安装成功，但是界面总是显示不出来。实在不想折腾了，就直接装了一个 Windows 的虚拟机，有一些需要编辑的文件就通过共享的方式在宿主机上进行编辑&lt;/p>
&lt;p>Linux 上 samba 的安装以及 Windows 文件共享的设置倒是一帆风顺，没出现什么问题，不过在 Linux 下获取 Windows 共享目录的时候却出现了异常&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 正常打印出了 users 目录下的内容&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ smbclient -c &lt;span style="color:#e6db74">&amp;#34;dir&amp;#34;&lt;/span> //ip/users -U user%passwd
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>. DR &lt;span style="color:#ae81ff">0&lt;/span> Wed Apr &lt;span style="color:#ae81ff">13&lt;/span> 17:52:49 &lt;span style="color:#ae81ff">2022&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>.. DR &lt;span style="color:#ae81ff">0&lt;/span> Wed Apr &lt;span style="color:#ae81ff">13&lt;/span> 17:52:49 &lt;span style="color:#ae81ff">2022&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Default DHR &lt;span style="color:#ae81ff">0&lt;/span> Wed Apr &lt;span style="color:#ae81ff">13&lt;/span> 17:52:49 &lt;span style="color:#ae81ff">2022&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 继续打印用户目录下的内容时出现异常&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ smbclient -c &lt;span style="color:#e6db74">&amp;#34;dir&amp;#34;&lt;/span> //ip/users/test -U user%passwd
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>tree connect failed: NT_STATUS_BAD_NETWORK_NAME
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>经过一番冲浪之后大概确定原因是 Windows 使用的 samba 版本是 v1，而 Linux 下的 samba 版本是 v4，v4 并不直接向下兼容，&lt;code>smbclient&lt;/code> 又不支持指定 samba 版本，不指定 samba 版本就无法直接打印出共享目录中的文件，死循环&lt;/p>
&lt;p>不过通过 mount 使用 cifs 格式挂载共享目录的时候是可以指定 samba 版本的，修改命令，通过下面的方式可以将共享目录挂载到本地&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo mount -t cifs -o username&lt;span style="color:#f92672">=&lt;/span>windows_user,password&lt;span style="color:#f92672">=&lt;/span>windows_user_password,vers&lt;span style="color:#f92672">=&lt;/span>1.0,gid&lt;span style="color:#f92672">=&lt;/span>$GID,uid&lt;span style="color:#f92672">=&lt;/span>$UID //ip/共享路径 /home/test/samba_mount_path
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>这里注意把 windows_user、windows_user_password、ip、共享路径修改为 Windows 对应的信息，/home/test/samba_mount_path 是在 Linux 下的挂载点&lt;/li>
&lt;li>vers=1.0 指定的是 samba 的协议版本&lt;/li>
&lt;/ul>
&lt;p>因为一般情况下都是由 root 用户来进行 mount 操作的，挂载到本地的目录所属用户及用户组也是 root，对其中的文件进行操作时需要添加 sudo 前缀命令，为了让普通用户能直接操作，此处需要指定 gid=$GID,uid=$UID 两个参数，分别代表当前用户所属用户组的 ID 和当前用户的 ID&lt;/p></description></item><item><title>IPhone 无法移动文件到 samba 共享目录</title><link>https://www.dianbanjiu.com/post/iphone-%E6%97%A0%E6%B3%95%E7%A7%BB%E5%8A%A8%E6%96%87%E4%BB%B6%E5%88%B0-samba-%E5%85%B1%E4%BA%AB%E7%9B%AE%E5%BD%95/</link><pubDate>Fri, 15 Oct 2021 00:43:52 +0800</pubDate><guid>https://www.dianbanjiu.com/post/iphone-%E6%97%A0%E6%B3%95%E7%A7%BB%E5%8A%A8%E6%96%87%E4%BB%B6%E5%88%B0-samba-%E5%85%B1%E4%BA%AB%E7%9B%AE%E5%BD%95/</guid><description>&lt;p>为了在局域网设备之间进行文件共享，最近一直在折腾 samba，目前已经基本上算是搞好了。但是在这个过程中也遇到了一个比较蛋疼的事情，就是通过 PC 和 Android 都可以正常向共享目录写入文件，在 IPhone 端虽然可以正常查看共享目录中的文件，但是无法将 IPhone 上的文件移动/复制到共享目录中。每次通过 IPhone 向共享目录中写入文件都会出现下面的报错：&lt;br>
&lt;img src="https://i.imgur.com/D4PxRwz.png" alt="Imgur">&lt;/p>
&lt;p>经过我在网上的一番冲浪之后找到了如下的解决方案：&lt;/p>
&lt;p>在 samba 配置文件的 [global] 中添加 &lt;code>vfs objects = fruit streams_xattr&lt;/code>（当然也可以仅针对某些特定的共享目录单独配置），然后重启 samba 服务，注意是重启 restart，不是重新加载配置文件 reload。仅重新加载配置文件这个规则还是无法生效的。&lt;/p>
&lt;p>samba 中的 VFS（虚拟文件系统）可以通过一些扩展模块增强 samba 的功能，而上面这行配置启用了 VFS 的两个模块，其中对解决本次问题起主要作用的是 &lt;code>fruit&lt;/code> 模块（可以的，果子🤣），这个模块主要是增强 samba 与 Apple 系统的兼容性。&lt;/p>
&lt;p>此外，如果从 IPhone 一次性向共享文件写入大量文件的话，可能会出现有些文件写失败的情况，这个问题暂时还没有找到解决方案，不过因为一次性写入大量文件需求也不是很多，暂时并不影响体验。&lt;/p>
&lt;p>&lt;a href="https://wiki.samba.org/index.php/Virtual_File_System_Modules">https://wiki.samba.org/index.php/Virtual_File_System_Modules&lt;/a>&lt;/p></description></item></channel></rss>