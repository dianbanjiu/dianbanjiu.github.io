<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Privoxy on 点半九</title><link>https://blog.djangozane.com/tags/privoxy/</link><description>Recent content in Privoxy on 点半九</description><generator>Hugo -- gohugo.io</generator><language>en</language><lastBuildDate>Fri, 30 Aug 2019 18:34:00 +0800</lastBuildDate><atom:link href="https://blog.djangozane.com/tags/privoxy/index.xml" rel="self" type="application/rss+xml"/><item><title>Linux 客户端代理配置</title><link>https://blog.djangozane.com/post/linux-%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE/</link><pubDate>Fri, 30 Aug 2019 18:34:00 +0800</pubDate><guid>https://blog.djangozane.com/post/linux-%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE/</guid><description>&lt;h2 id="购买服务"&gt;购买服务&lt;/h2&gt;
&lt;p&gt;最开始是自建的 shadowsocks 服务，使用的搬瓦工洛杉矶的服务器，但是速度不是很理想，而且还经常被封。后来迁移数据的时候，发现搬瓦工也有单独的 shadowsocks 服务出售，相对于自建来说成本更低，相较来说算是个不错的选择。&lt;/p&gt;
&lt;p&gt;费用如下图所示&lt;br&gt;
&lt;img src="https://imgur.com/iJGqs6F.png" alt="Imgur"&gt;&lt;br&gt;
这个是最便宜的那个套餐，每月 100G 的流量，因为我平时多的话也不过 50 左右，所以就选了这个，如果你嫌少，他们还有每月 500/1000G 的套餐，世界加钱可及。&lt;/p&gt;
&lt;p&gt;速度的话，YouTube 1080p 基本上可以全程无卡顿，至于 2k、4k 的话，也可以，不过会有偶尔的卡顿。&lt;/p&gt;
&lt;p&gt;如果你也想购买他们的服务，可以 &lt;a href="https://justmysocks.net/members/aff.php?aff=4151"&gt;点击此处直达&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2022 年 7 月 15 号更新&lt;/strong&gt;&lt;br&gt;
弃用了 Qv2ray 和 shadowsocks-libev，统一使用 &lt;a href="https://github.com/Dreamacro/clash"&gt;clash&lt;/a&gt; 配置代理&lt;/p&gt;
&lt;p&gt;clash 是一个用 go 写的多平台代理工具，我这里使用的是无图形界面的版本，你可以直接从包管理器里面安装，或者从项目的 release 下载&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# Arch Linux&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;sudo pacman -S clash
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# windows&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;scoop install clash
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;安装完成之后需要先运行一次 clash 程序下载 &lt;code&gt;Country.mmdb&lt;/code&gt; 并且初始化 &lt;code&gt;config.yaml&lt;/code&gt;，这两个文件一般位于用户主目录下面的 &lt;code&gt;.config/clash&lt;/code&gt; 下面&lt;/p&gt;
&lt;p&gt;接着只需要修改 config.yaml 文件，并且添加自己的服务配置信息即可&lt;/p&gt;
&lt;p&gt;一些参数的基础配置可以参考 &lt;a href="https://github.com/dianbanjiu/just/tree/main/clash"&gt;此处&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;2020 年 9 月 7 日更新&lt;/strong&gt;&lt;br&gt;
现在 justmysocks 默认的五个连接中的三个已经从 shadowsocks 修改为了 vmess 协议，虽然 shadowsocks-libev 可以安装 v2ray 插件来支持 vmess，但是总的来说配置还是不够直观，而 shadowsocks-qt 也并没有提供插件的计划，所以现在我已经改为使用 &lt;code&gt;qv2ray&lt;/code&gt; 来作为新的代理工具了。&lt;/p&gt;
&lt;h2 id="qv2ray"&gt;Qv2ray&lt;/h2&gt;
&lt;p&gt;需要安装的软件：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Qv2ray&lt;/li&gt;
&lt;li&gt;v2ray&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;安装完成之后，打开 Qv2ray，点击左上角的 &lt;code&gt;首选项&lt;/code&gt;，在 &lt;code&gt;内核设置&lt;/code&gt; 处确保 v2ray 核心选择正确。&lt;br&gt;
&lt;img src="https://blog.djangozane.com/resources/_gen/images/qv2ray%E9%A6%96%E9%80%89%E9%A1%B9.png" alt=""&gt;&lt;/p&gt;
&lt;p&gt;在 &lt;code&gt;入站设置&lt;/code&gt; 中勾选设置 &lt;code&gt;系统代理&lt;/code&gt;，并启用 &lt;code&gt;socks设置&lt;/code&gt; 与 &lt;code&gt;http设置&lt;/code&gt;（Linux 在此处只需设置 系统代理，MacOS 三项都需开启）。&lt;/p&gt;
&lt;p&gt;在 &lt;code&gt;连接设置&lt;/code&gt; 中，启用 &lt;code&gt;绕过中国大陆&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;最后点击左下角的 &lt;code&gt;新建&lt;/code&gt; 按钮，选择 &lt;code&gt;二维码&lt;/code&gt;，在你的 justmysocks 界面截屏扫描对应的帐号二维码即可添加 socks 或者 v2ray 链接。&lt;/p&gt;
&lt;p&gt;Linux 下启用 &lt;code&gt;系统代理&lt;/code&gt; 后，浏览器无需设置任何代理工具就可以直接访问 google，而在 MacOS 下则仍需配置浏览器代理，所以 Linux 在第二步中只需设置 系统代理，而 MacOS 三项都需开启才能正常使用。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="shadowsocks-配置"&gt;shadowsocks 配置&lt;/h2&gt;
&lt;p&gt;首先使用系统的包管理软件安装 shadowsocks-libev 这个软件包。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ sudo pacman -S shadowsocks-libev &lt;span style="color:#75715e"&gt;# Arch Linux&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ sudo apt install shadowsocks-libev &lt;span style="color:#75715e"&gt;# Debian/Ubuntu&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在 /etc/shadowsocks 下创建 config.json 文件。在其中写入以下内容，将其中的字段根据情况修改，主要是服务器的地址(server)、密码(password)、端口号(server_port)、加密方法(method)。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;&amp;#34;server&amp;#34;&lt;/span&gt;:&lt;span style="color:#e6db74"&gt;&amp;#34;my_server_ip&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;&amp;#34;server_port&amp;#34;&lt;/span&gt;:&lt;span style="color:#ae81ff"&gt;8388&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;&amp;#34;local_address&amp;#34;&lt;/span&gt;: &lt;span style="color:#e6db74"&gt;&amp;#34;127.0.0.1&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;&amp;#34;local_port&amp;#34;&lt;/span&gt;:&lt;span style="color:#ae81ff"&gt;1080&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;&amp;#34;password&amp;#34;&lt;/span&gt;:&lt;span style="color:#e6db74"&gt;&amp;#34;mypassword&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;&amp;#34;timeout&amp;#34;&lt;/span&gt;:&lt;span style="color:#ae81ff"&gt;300&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;&amp;#34;method&amp;#34;&lt;/span&gt;:&lt;span style="color:#e6db74"&gt;&amp;#34;aes-256-cfb&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;&amp;#34;fast_open&amp;#34;&lt;/span&gt;: &lt;span style="color:#66d9ef"&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;shadowsocks-libev 添加 obfs 插件，在配置文件中还需要添加两行：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;plugin&amp;#34;&lt;/span&gt;&lt;span style="color:#960050;background-color:#1e0010"&gt;:&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;obfs-local&amp;#34;&lt;/span&gt;&lt;span style="color:#960050;background-color:#1e0010"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;plugin_opts&amp;#34;&lt;/span&gt;&lt;span style="color:#960050;background-color:#1e0010"&gt;:&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;obfs=tls&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;配置好文件后，使用下面的命令启动 shadowsocks 服务：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ sudo systemctl start shadowsocks-libev@config.service
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;如果想要开机自启动的话：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ sudo systemctl enable shadowsocks-libev@config.service
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;当然，你也可以选择使用带有前端界面的 &lt;code&gt;shadowsocks-qt5&lt;/code&gt; 程序，它在大多数的发行版中都可以找到。&lt;/p&gt;
&lt;p&gt;因为并不是所有的程序都支持 socks 服务，但是大多数的程序都支持 http 代理，下面就通过 privoxy 将 socks 转发为 http 代理。&lt;/p&gt;
&lt;h2 id="privoxy-配置"&gt;privoxy 配置&lt;/h2&gt;
&lt;p&gt;首先下载 &lt;code&gt;privoxy&lt;/code&gt; 这个软件包。&lt;/p&gt;
&lt;p&gt;编辑 privoxy 的配置文件 &lt;code&gt;/etc/privoxy/config&lt;/code&gt;，在其中添加下面一行，转发 socks5：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;forward-socks5 / localhost:1080 .
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;注意在最后有一个点&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;使用下面的命令启动 privoxy&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ sudo systemctl start privoxy.service
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;建议将该服务设置为开机自启动。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ sudo systemctl enable privoxy.service
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;至此为止，shadowsocks 就在 Linux 客户端设置完毕，也成功将 socks5 转发为 http，可以通过 chromium 来验证一下是否可用。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ http_proxy&lt;span style="color:#f92672"&gt;=&lt;/span&gt;http://127.0.0.1:8118 chromium
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;如果可以正常使用 google 就说明配置成功了。&lt;/p&gt;</description></item></channel></rss>